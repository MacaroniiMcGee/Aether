# WaveLynx Python OSDP Console

This library exposes utility functions for interacting with a WaveLynx access reader
via OSDP (often via a RS485-USB connection to a host machine). The commands provided
implement a subset of the OSDP specification in order to accomplish basic tasks.

**Supported Features:**

* Basic polling w/ output logging.
* File transfer.
* Beacon/touch configuration.
* Setting of reader serial numbers.
* Pull extended reader configuration.

## Installation

These scripts require `pyhton 3.7` or later to run along with `pip`.

Dependencies can be installed via:

```
pip install -r requirements.txt
```

## Usage

The entrypoint for the console is invoked using:

```
python3 console.py
```

The script supports the following arguments:

| Flag                      | Arguments                | Description                                                                      |
|---------------------------|--------------------------|----------------------------------------------------------------------------------|
| `-v` or `--verbose`       | None                     | Enable verbose message logging.                                                  |
| `-i` or `--ibeacon`       | None                     | Configure the reader with the beacon/touch settings located in `ibeaconconf.py`. |
| `-c` or `--config`        | Device name              | Use configuration for the specified device from `config.json`.                   |
| `-f` or `--file`          | Path to binary file      | Transfer a file to the reader.                                                   |
| `-p` or `--poll`          | None                     | Poll the reader and log events.                                                  |
| `-s` or `--serial`        | 8-byte hex serial number | Load a serial number into the reader (must already be unset).                    |
| `-P` or `--port`          | Serial port              | Set the serial port to use.                                                      |
| `-b` or `--baud`          | Baud rate                | Set the baud rate for serial communication.                                      |
| `-S` or `--secure`        | None                     | Initialize in secure OSDP mode.                                                  |
| `-F` or `--flush-log`     | None                     | Flush the log file before starting.                                              |
| `-r` or `--repl`          | None                     | Start a REPL session.                                                            |
| `-C` or `--command`       | Command                  | Send a one-off command to the controller.                                        |
| `-L` or `--list-commands` | None                     | List all supported commands.                                                     |

### Examples

Poll forever and log verbose events:

```
python3 console.py -v -p
```

**NOTE:** This script will run indefinitely until the process is mainly exited via `C-c`.

Send a file to the reader:

```
python3 console.py -f /path/to/firmware.bin
```

Set the reader's serial number:

```
python3 console.py -s 0102030405060708
```
Start a REPL session:
```
python3 console.py -r
```
Send a one off command
```
python3 console.py -C id
```
List available commands for one off or REPL
```
python3 console.py -L
```
Use a specific port or baud rate
```
python3 console.py -b 115200 -P 'ttyUSB0'
```
Launch with a secure session
```
python3 console.py -p --secure
```
Use a specific configuration from 'config.json'
```
python3 console.py -c lock -C id
```


## Logs

All logs generated by the script will be appended to a file in the base project directory titled:
`osdpcapture.log`. The verbosity of the output to this file will depend on whether the `-v` flag
is supplied during running. This file can be flushed before new commands are run with the flush flag `-F`.

## Touch and Beacon Settings

To enable/disable touch and its associated beacon settings, you must edit the configuration
located at `osdplib/ibeaconconf.py`. This script covers all of the available settings and
comprises the data sent when the `-i` flag is passed to the script.
